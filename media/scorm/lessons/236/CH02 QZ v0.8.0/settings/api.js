!function(){var t={isInited:!1},e=location.protocol+"//"+location.host,n=e+"/auth/identity",i=e+"/api/v1/course/"+c("courseId")+"/template/"+c("templateId")+"/configuration/settings",a=location.toString().substring(0,location.toString().indexOf("/settings/"))+"/",o=a+"manifest.json",s={Authorization:"Bearer "};function r(){return f("token.settings")}function u(){if(!t.isInited)throw"Sorry, but you've tried to use api before it was initialized"}function c(t){var e=RegExp(t+"=(.+?)(&|$)").exec(location.search)||null;return null===e?null:decodeURI(e[1])}function g(t,e){p({type:"notification",data:{success:e,message:t}})}function p(t){window.parent.postMessage(t,"*")}function f(t){for(var e=t+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var a=n[i];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(e))return a.substring(e.length,a.length)}}window.egApi={init:function(){s.Authorization+=c("token")||r();var e=$.ajax({url:n,headers:{Authorization:"Bearer "+f("token.auth")},cache:!1,type:"POST",contentType:"application/json",dataType:"json"}),u=$.ajax({url:i,headers:{Authorization:"Bearer "+f("token.api")},cache:!1,contentType:"application/json",dataType:"json"}),g=$.ajax({url:o,headers:s,cache:!1,contentType:"application/json",dataType:"json"});return $.when(g,e,u).done(function(e,n,i){t.manifest=function(t){if(t&&t.languages&&t.languages.length>0)for(var e=0;e<t.languages.length;e++)t.languages[e].url=a+t.languages[e].url;return t}(e[0]),t.user=function(t){var e={accessType:0};t.subscription&&t.subscription.accessType&&t.subscription.accessType>=1&&new Date(t.subscription.expirationDate)>=new Date&&(e.accessType=t.subscription.accessType);return e}(n[0]),t.settings=function(t){var e;e=t.settings&&t.settings.length>0?JSON.parse(t.settings):{};return e}(i[0]),t.isInited=!0})},getManifest:function(){return u(),t.manifest},getUser:function(){return u(),t.user},getSettings:function(){return u(),t.settings},saveSettings:function(t,e,n){p({type:"freeze-editor"});var a={url:i,type:"POST",headers:s,cache:!1,dataType:"json",data:{settings:t}};return $.ajax(a).done(function(){g(e,!0)}).fail(function(){g(n,!1)}).always(function(){p({type:"unfreeze-editor"})})},sendNotificationToEditor:g,showSettings:function(){p({type:"show-settings"})},getSettingsToken:r}}();